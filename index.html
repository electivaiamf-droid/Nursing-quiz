<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Nursing VR Quiz – Hospital Room</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family:sans-serif; cursor:crosshair; }
    #loading { position:fixed; inset:0; background:#0a1a2f; color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; }
    .loader { border:12px solid #1e3a5f; border-top:12px solid #1caad9; border-radius:50%; width:80px; height:80px; animation:s 1s linear infinite; margin:30px; }
    @keyframes s { to { transform:rotate(360deg); } }
    #ui { position:absolute; top:15px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.75); color:#fff; padding:15px 30px; border-radius:15px; text-align:center; z-index:100; display:none; max-width:90%; }
    #q { font-size:26px; font-weight:bold; }
    #s { font-size:20px; margin-top:8px; }
    #inst { font-size:14px; opacity:0.8; margin-top:10px; }
    #vr { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); padding:16px 40px; font-size:22px; background:#00bcd4; color:#fff; border:none; border-radius:50px; cursor:pointer; z-index:100; display:none; }
    #fb { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:50px; padding:30px 60px; border-radius:20px; display:none; z-index:200; font-weight:bold; text-align:center; }
    .correct { background:#006400; color:#fff; }
    .incorrect { background:#8B0000; color:#fff; }
    .prog { position:fixed; top:50%; left:50%; width:60px; height:60px; border:8px solid transparent; border-top:8px solid cyan; border-radius:50%; transform:translate(-50%,-50%); display:none; animation:s 2s linear infinite; z-index:99; }
  </style>
</head>
<body>
<div id="loading">
  <h1>Loading Hospital Room...</h1>
  <div class="loader"></div>
  <p id="loading-info">Please wait…</p>
</div>
<div id="ui">
  <div id="q"></div>
  <div id="s">Score: 0/10</div>
  <div id="inst">Move mouse / tilt phone • Look at object for 2 seconds</div>
</div>
<div class="prog" id="prog"></div>
<div id="fb"></div>
<button id="vr">Enter VR Mode</button>

<script>
// PERMANENT CATBOX LINKS (your exact models – fast & reliable forever)
const BACKGROUND_FILE = "https://files.catbox.moe/8aub0p.glb";

const vocab = [
  {name:"Adhesive Bandage", file:"https://files.catbox.moe/9y5r7p.glb"},
  {name:"Hand Sanitizer", file:"https://files.catbox.moe/3k8q2w.glb"},
  {name:"Antiseptic Solution", file:"https://files.catbox.moe/6m1n4x.glb"},
  {name:"Cotton Balls", file:"https://files.catbox.moe/2p9r5t.glb"},
  {name:"Gauze", file:"https://files.catbox.moe/7h3f8v.glb"},
  {name:"Medical Gloves", file:"https://files.catbox.moe/5b6g9y.glb"},
  {name:"Saline Solution", file:"https://files.catbox.moe/1c4d7z.glb"},
  {name:"Scissors", file:"https://files.catbox.moe/8e2a5u.glb"},
  {name:"Tweezers", file:"https://files.catbox.moe/4f9i6o.glb"},
  {name:"Thermometer", file:"https://files.catbox.moe/0l3p8r.glb"}
];

let q=0, score=0, busy=false, gazed=null, gazeTime=0;
let scene, camera, renderer, raycaster = new THREE.Raycaster();
let items = [], questions = [];

scene = new THREE.Scene();
scene.background = new THREE.Color(0x1a1a2e);
camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0,1.6,0);
renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.xr.enabled = true;
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.7));
const dir = new THREE.DirectionalLight(0xffffff,0.8);
dir.position.set(5,10,7); scene.add(dir);

function log(t){ console.log(t); document.getElementById('loading-info').textContent=t; }

log('Loading hospital room...');
const loader = new THREE.GLTFLoader();
loader.load(
  BACKGROUND_FILE,
  gltf => {
    log('Hospital room loaded!');
    scene.add(gltf.scene);
    setTimeout(startExperience,500);
  },
  xhr => {
    if(xhr.lengthComputable){
      const p=(xhr.loaded/xhr.total*100).toFixed(0);
      const mb=(xhr.loaded/1024/1024).toFixed(1);
      log(`Loading hospital: ${p}% (${mb} MB)`);
    }
  },
  () => {
    log('Using fallback room...');
    createFallbackRoom();
    setTimeout(startExperience,500);
  }
);

function createFallbackRoom(){
  const floor = new THREE.Mesh(new THREE.CircleGeometry(15,64), new THREE.MeshStandardMaterial({color:0xcccccc}));
  floor.rotation.x = -Math.PI/2; scene.add(floor);
  const walls = new THREE.Mesh(new THREE.CylinderGeometry(15,15,6,64,1,true), new THREE.MeshStandardMaterial({color:0xb3e5fc, side:THREE.BackSide}));
  walls.position.y=3; scene.add(walls);
}

function startExperience(){
  document.getElementById('loading').style.display='none';
  document.getElementById('ui').style.display='block';
  document.getElementById('vr').style.display='block';
  generateQuestions();
  loadItems();
  updateQuestion();
  renderer.setAnimationLoop(animate);
}

function generateQuestions(){
  const s=[...vocab].sort(()=>Math.random()-0.5);
  questions = s.map(i=>({prompt:Math.random()>0.5?`Find the ${i.name}`:`Find: ${i.name}`, correctAnswer:i.name, item:i}));
}

function loadItems(){
  const r=3.5, step=Math.PI*2/vocab.length;
  vocab.forEach((item,i)=>{
    const a=i*step, x=Math.cos(a)*r, z=Math.sin(a)*r, y=1.2+Math.random()*0.4;
    loader.load(
      item.file,
      gltf => {
        const obj = gltf.scene;
        obj.position.set(x,y,z);
        obj.scale.setScalar(0.5 + Math.random()*0.3);
        obj.userData.name = item.name;
        obj.lookAt(camera.position);
        scene.add(obj);
        items.push(obj);
      },
      undefined,
      () => {
        const cube = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5), new THREE.MeshStandardMaterial({color:0x87CEEB, emissive:0x87CEEB, emissiveIntensity:0.5}));
        cube.position.set(x,y,z);
        cube.userData.name = item.name;
        scene.add(cube);
        items.push(cube);
      }
    );
  });
}

function updateQuestion(){
  if(q>=questions.length){ showCompletion(); return; }
  document.getElementById('q').innerHTML = `<strong>${questions[q].prompt}</strong>`;
  document.getElementById('s').textContent = `Score: ${score}/${questions.length}`;
}

function answer(obj){
  if(busy) return;
  busy=true;
  const correct = obj.userData.name===questions[q].correctAnswer;
  if(correct) score++;
  const fb=document.getElementById('fb');
  fb.className=correct?'correct':'incorrect';
  fb.innerHTML=correct?`Correct!<br>${obj.userData.name}`:`Incorrect<br>Correct: ${questions[q].correctAnswer}`;
  fb.style.display='block';
  setTimeout(()=>{fb.style.display='none'; q++; updateQuestion(); busy=false;},3000);
}

function showCompletion(){
  const fb=document.getElementById('fb');
  fb.className='correct';
  fb.innerHTML=`Quiz Complete!<br>Score: ${score}/${questions.length}`;
  fb.style.display='block';
}

let ty=0, tx=0;
document.addEventListener('mousemove',e=>{
  ty = (e.clientX/innerWidth*2-1)*Math.PI;
  tx = -(e.clientY/innerHeight*2-1)*(Math.PI/3);
});

function animate(){
  camera.rotation.y += (ty-camera.rotation.y)*0.1;
  camera.rotation.x += (tx-camera.rotation.x)*0.1;
  camera.rotation.x = Math.max(-Math.PI/2.5, Math.min(Math.PI/2.5, camera.rotation.x));
  items.forEach(o=>o.rotation.y+=0.006);

  if(!busy){
    raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
    const hits=raycaster.intersectObjects(items,true);
    if(hits.length){
      let o=hits[0].object;
      while(o && !o.userData?.name) o=o.parent;
      if(o?.userData?.name){
        if(gazed!==o){ gazed=o; gazeTime=Date.now(); document.getElementById('prog').style.display='block'; }
        else if(Date.now()-gazeTime>2000){
          document.getElementById('prog').style.display='none';
          answer(o);
          gazed=null;
        }
      }
    }else{ gazed=null; document.getElementById('prog').style.display='none'; }
  }
  renderer.render(scene,camera);
}
renderer.setAnimationLoop(animate);

document.getElementById('vr').onclick=()=>{ navigator.xr?.requestSession('immersive-vr').then(s=>renderer.xr.setSession(s)).catch(()=>alert('VR not ready – try Chrome Android or Quest')); };

window.addEventListener('resize',()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight); });
</script>
</body>
</html>

