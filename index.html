<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nursing VR Quiz – Hospital Room</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family:Arial,Helvetica,sans-serif; cursor: crosshair; }
    #loading { position:fixed; inset:0; background:#0a1a2f; color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; }
    #loading-info { margin-top: 20px; font-size: 14px; opacity: 0.7; max-width: 500px; text-align: center; }
    .loader { border:10px solid #1e3a5f; border-top:10px solid #1caad9; border-radius:50%; width:70px; height:70px; animation:s 1s linear infinite; margin:20px; }
    @keyframes s { to { transform:rotate(360deg); } }
    #ui { position:absolute; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:#fff; padding:18px 35px; border-radius:15px; text-align:center; z-index:100; display:none; max-width: 90%; }
    #q { font-size:28px; font-weight:bold; margin:10px 0; }
    #s { font-size:22px; }
    #inst { font-size:14px; margin-top:10px; opacity:0.8; }
    #vr { position:fixed; bottom:25px; left:50%; transform:translateX(-50%); padding:18px 40px; font-size:22px; background:#1caad9; color:#fff; border:none; border-radius:50px; cursor:pointer; z-index:100; display:none; }
    #vr:hover { background:#1590b8; }
    #fb { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:60px; padding:40px 80px; border-radius:25px; display:none; z-index:200; font-weight:bold; text-align:center; }
    .correct { background:#006400; color:#fff; }
    .incorrect { background:#8B0000; color:#fff; }
    .gaze { position:fixed; top:50%; left:50%; width:30px; height:30px; border:3px solid rgba(255,255,255,0.8); border-radius:50%; transform:translate(-50%,-50%); pointer-events:none; z-index:99; }
    .prog { position:fixed; top:50%; left:50%; width:50px; height:50px; border:6px solid transparent; border-top:6px solid #00ffff; border-radius:50%; transform:translate(-50%,-50%); display:none; animation:s 2s linear infinite; z-index:99; }
  </style>
</head>
<body>
<div id="loading">
  <h1>Loading Hospital Room...</h1>
  <div class="loader"></div>
  <p id="loading-info">Preparing VR experience...</p>
</div>
<div id="ui">
  <div id="q">Find the Adhesive Bandage</div>
  <div id="s">Score: 0/10</div>
  <div id="inst">Move mouse to look around • Center crosshair on object for 2 seconds</div>
</div>
<div class="gaze"></div>
<div class="prog" id="prog"></div>
<div id="fb"></div>
<button id="vr">Enter VR Mode</button>
<script>
// ==== FINAL WORKING LINKS (Google Drive) ====
const BACKGROUND_FILE = "https://drive.google.com/uc?export=download&id=1VfcwowYJyIKIJS1ZBuN7PyusTgpIoW6a";

// If you upload the other 10 models to the same Drive folder and share them the same way,
// just replace the IDs below. Until then, nice colored cubes appear as fallback.
const vocab = [
  {name:"Adhesive Bandage",     file:"bandage.glb",     color:0xF5DEB3},
  {name:"Hand Sanitizer",       file:"sanitizer.glb",   color:0x87CEEB},
  {name:"Antiseptic Solution",  file:"antiseptic.glb",  color:0xDDA0DD},
  {name:"Cotton Balls",         file:"cotton.glb",      color:0xFFFFFF},
  {name:"Gauze",                file:"gauze.glb",       color:0xFAFAFA},
  {name:"Medical Gloves",       file:"gloves.glb",      color:0x98D8C8},
  {name:"Saline Solution",      file:"saline.glb",      color:0xADD8E6},
  {name:"Scissors",             file:"scissors.glb",    color:0xC0C0C0},
  {name:"Tweezers",             file:"tweezers.glb",    color:0xB0B0B0},
  {name:"Thermometer",          file:"thermometer.glb", color:0xFF6B6B}
];
// =============================================
let q=0, score=0, busy=false, gazed=null, gazeTime=0;
let scene, camera, renderer, raycaster = new THREE.Raycaster();
let items = [];
let questions = [];

scene = new THREE.Scene();
scene.background = new THREE.Color(0x1a1a2e);
camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 1.6, 0);
renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.xr.enabled = true;
renderer.outputEncoding = THREE.sRGBEncoding;
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
dirLight.position.set(5,10,7); scene.add(dirLight);
const pointLight = new THREE.PointLight(0xffffff, 0.5);
pointLight.position.set(-5,5,-5); scene.add(pointLight);

function log(msg) {
  console.log(msg);
  document.getElementById('loading-info').textContent = msg;
}

log('Loading hospital room...');
const loader = new THREE.GLTFLoader();
loader.load(
  BACKGROUND_FILE,
  gltf => {
    log('Hospital room loaded!');
    scene.add(gltf.scene);
    setTimeout(startExperience, 500);
  },
  xhr => {
    if (xhr.lengthComputable) {
      const percent = (xhr.loaded / xhr.total * 100).toFixed(0);
      const mb = (xhr.loaded / 1024 / 1024).toFixed(1);
      log(`Loading hospital: ${percent}% (${mb} MB)`);
    }
  },
  err => {
    log('Using fallback room...');
    console.error(err);
    createFallbackRoom();
    setTimeout(startExperience, 500);
  }
);

function createFallbackRoom() {
  const floor = new THREE.Mesh(new THREE.CircleGeometry(15,64), new THREE.MeshStandardMaterial({color:0xd0d0d0}));
  floor.rotation.x = -Math.PI/2; scene.add(floor);
  const walls = new THREE.Mesh(new THREE.CylinderGeometry(15,15,6,64,1,true), new THREE.MeshStandardMaterial({color:0xe0f2f7, side:THREE.BackSide}));
  walls.position.y = 3; scene.add(walls);
}

function startExperience() {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('ui').style.display = 'block';
  document.getElementById('vr').style.display = 'block';
  generateQuestions();
  loadItems();
  updateQuestion();
  renderer.setAnimationLoop(animate);
}

function generateQuestions() {
  const shuffled = [...vocab].sort(() => Math.random() - 0.5);
  questions = shuffled.map(item => ({
    prompt: Math.random() > 0.5 ? `Find the ${item.name}` : `Find: ${item.uses || item.name}`,
    correctAnswer: item.name,
    item
  }));
}

function loadItems() {
  const radius = 3.5;
  const angleStep = (Math.PI * 2) / vocab.length;

  questions.forEach((qst, i) => {
    const angle = i * angleStep;
    const x = Math.cos(angle) * radius;
    const z = Math.sin(angle) * radius;
    const y = 1.2 + Math.random()*0.4;
    const data = qst.item;

    // Try to load real model from Drive, fall back to colored cube
    loader.load(
      `https://drive.google.com/uc?export=download&id=PUT_ID_HERE_FOR_${data.file.toUpperCase()}`,
      gltf => {
        const obj = gltf.scene;
        obj.position.set(x,y,z);
        obj.scale.setScalar(0.5 + Math.random()*0.3);
        obj.userData.name = data.name;
        obj.lookAt(camera.position);
        scene.add(obj);
        items.push(obj);
      },
      undefined,
      () => {
        // Fallback cube (nice colors)
        const cube = new THREE.Mesh(
          new THREE.BoxGeometry(0.4,0.4,0.4),
          new THREE.MeshStandardMaterial({color: data.color, emissive: data.color, emissiveIntensity:0.4})
        );
        cube.position.set(x,y,z);
        cube.userData.name = data.name;
        scene.add(cube);
        items.push(cube);
      }
    );
  });
}

// (the rest of the script is unchanged – updateQuestion, answer, VR button, mouse gaze, etc.)
function updateQuestion() {
  if (q >= questions.length) { showCompletion(); return; }
  document.getElementById('q').innerHTML = `<strong>${questions[q].prompt}</strong>`;
  document.getElementById('s').textContent = `Score: ${score}/${questions.length}`;
}

function answer(obj) {
  if (busy) return;
  busy = true;
  const correct = obj.userData.name === questions[q].correctAnswer;
  if (correct) score++;
  const fb = document.getElementById('fb');
  fb.className = correct ? 'correct' : 'incorrect';
  fb.innerHTML = correct ? `Correct!<br>${obj.userData.name}` : `Incorrect<br>You selected: ${obj.userData.name}<br>Correct: ${questions[q].correctAnswer}`;
  fb.style.display = 'block';
  setTimeout(() => fb.style.display = 'none', 2800);
  setTimeout(() => { q++; updateQuestion(); busy = false; }, 3000);
}

function showCompletion() {
  const fb = document.getElementById('fb');
  fb.className = 'correct';
  fb.innerHTML = `Quiz Complete!<br>Final score: ${score}/${questions.length}`;
  fb.style.display = 'block';
}

// mouse gaze + VR button + resize stay the same
let mouseX = 0, mouseY = 0, ty = 0, tx = 0;
document.addEventListener('mousemove', e => {
  mouseX = (e.clientX / innerWidth) * 2 - 1;
  mouseY = (e.clientY / innerHeight) * 2 - 1;
  ty = mouseX * Math.PI;
  tx = -mouseY * (Math.PI/3);
});
function animate() {
  camera.rotation.y += (ty - camera.rotation.y) * 0.1;
  camera.rotation.x += (tx - camera.rotation.x) * 0.1;
  camera.rotation.x = Math.max(-Math.PI/2.5, Math.min(Math.PI/2.5, camera.rotation.x));
  items.forEach(o => o.rotation.y += 0.005);

  if (!busy) {
    raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
    const hits = raycaster.intersectObjects(items, true);
    if (hits.length) {
      let obj = hits[0].object;
      while (obj && !obj.userData?.name) obj = obj.parent;
      if (obj?.userData?.name) {
        if (gazed !== obj) { gazed = obj; gazeTime = Date.now(); document.getElementById('prog').style.display = 'block'; }
        else if (Date.now() - gazeTime > 2000) {
          document.getElementById('prog').style.display = 'none';
          answer(obj);
          gazed = null;
        }
      }
    } else { gazed = null; document.getElementById('prog').style.display = 'none'; }
  }
